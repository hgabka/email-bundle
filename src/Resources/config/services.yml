parameters:
    hgabka_email.mail_builder.class: 'Hgabka\EmailBundle\Helper\MailBuilder'
    hgabka_email.message_logger.class: 'Hgabka\EmailBundle\Logger\MessageLogger'
    hgabka_email.message_sender.class: 'Hgabka\EmailBundle\Helper\MessageSender'
    hgabka_email.queue_manager.class: 'Hgabka\KunstmaanEmailBundle\Helper\QueueManager'

services:
    hgabka_email.mail_builder:
        class: '%hgabka_email.mail_builder.class%'
        arguments: ["@doctrine", "@request_stack", "@hgabka_email.param_substituter", "@translator", "@hgabka_utils.hgabka_utils", "@router"]

    hgabka_email.message_sender:
        class: '%hgabka_email.message_sender.class%'
        arguments: ["@doctrine", "@mailer", "@hgabka_email.queue_manager", "@translator", "@hgabka_utils.hgabka_utils", "@hgabka_email.mail_builder"]

    hgabka_email.message_logger:
        class: '%hgabka_email.message_logger.class%'
        arguments: ["@logger", '']

    hgabka_email.email_logger:
        class: 'Hgabka\EmailBundle\Logger\EmailLogger'
        arguments: ["@doctrine"]

    hgabka_email.queue_manager:
        class: '%hgabka_email.queue_manager.class%'
        arguments: ["@doctrine", "@mailer", "@hgabka_email.message_logger", '', '', '', '', '']
        calls:
            - method: setMailBuilder
              arguments:
                  - "@hgabka_email.mail_builder"

    hgabka_email.param_substituter:
        class: 'Hgabka\EmailBundle\Helper\ParamSubstituter'
        arguments: ["@request_stack", "%kernel.cache_dir%", "%kernel.project_dir%", []]

    hgabka_email.email_subscriber:
        class: Hgabka\EmailBundle\EventListener\EmailSubscriber
        tags:
            - { name: doctrine.event_subscriber, connection: default }

    hgabka_email.mailer_subscriber:
        class: Hgabka\EmailBundle\EventListener\MailerSubscriber
        arguments: ["@hgabka_email.email_logger", '']
        tags:
            - { name: kernel.event_subscriber }

    hgabka_email.mail_logger_plugin:
        class: Hgabka\EmailBundle\Mailer\MessageLoggerPlugin
        arguments: ["@event_dispatcher"]
        tags:
            - { name: "swiftmailer.default.plugin" }

    hgabka_email.redirect_plugin:
        class: Hgabka\EmailBundle\Mailer\RedirectPlugin
        arguments: [""]
        calls:
            - method: setHgabkaUtils
              arguments:
                  - "@hgabka_utils.hgabka_utils"

            - method: setDebug
              arguments:
                  - "%kernel.debug%"
        tags:
            - { name: "swiftmailer.default.plugin" }


    hgabka_kunstmaan_email.add_headers_plugin:
        class: Hgabka\EmailBundle\Mailer\AddHeadersPlugin
        arguments: ["@event_dispatcher"]
        tags:
            - { name: "swiftmailer.default.plugin" }

    hgabka_email.add_recipients_plugin:
        class: Hgabka\EmailBundle\Mailer\AddRecipientsPlugin
        tags:
            - { name: "swiftmailer.default.plugin" }

    hgabka_email.add_return_path_plugin:
        class: Hgabka\EmailBundle\Mailer\AddReturnPathPlugin
        tags:
            - { name: "swiftmailer.default.plugin" }

    hgabka_email.mailbox_reader:
        class: Hgabka\EmailBundle\Helper\MailboxReader
        arguments: ["@hgabka_email.email_parser", '', '', '', '', '', 'INBOX', '']

    hgabka_email.bounce_checker:
        class: Hgabka\EmailBundle\Helper\BounceChecker
        arguments: ["@doctrine", "@hgabka_email.mailbox_reader"]

    hgabka_email.email_parser:
        class: Hgabka\EmailBundle\Helper\EmailParser

    hgabka_email.email_template_type:
        class: Hgabka\EmailBundle\Form\EmailTemplateAdminType
        arguments: ["@doctrine.orm.entity_manager", "@security.authorization_checker"]
        tags:
            - { name: form.type }

    hgabka_email.subscriber_type:
        class: Hgabka\EmailBundle\Form\MessageSubscriberAdminType
        arguments: ["@doctrine.orm.entity_manager", "@hgabka_utils.hgabka_utils", "@hgabka_email.subscription_manager", "@security.authorization_checker"]
        tags:
            - { name: form.type }

    hgabka_email.message_type:
        class: Hgabka\EmailBundle\Form\MessageAdminType
        arguments: ["@doctrine.orm.entity_manager", "@hgabka_email.mail_builder", "@security.authorization_checker"]
        tags:
            - { name: form.type }

    hgabka_email.event_listener.entity_load:
        class: Hgabka\EmailBundle\EventListener\EntityLoadListener
        tags:
            - { name: doctrine.event_listener, event: postLoad }

    hgabka_email.adminlist_subscriber:
        class: Hgabka\EmailBundle\EventListener\AdminListSubscriber
        arguments: ["@doctrine"]
        tags:
            - { name: kernel.event_subscriber }

    hgabka_email.email_twig_extension:
        class: Hgabka\EmailBundle\Twig\EmailTwigExtension
        arguments: ['@hgabka_email.mail_builder']
        public: false
        tags:
            - { name: twig.extension }

    hgabka_email.email_voter:
        class:  Hgabka\EmailBundle\Security\EmailVoter
        arguments: ['@security.access.decision_manager', '']
        tags:
            - { name: security.voter }
        public: false

    hgabka_email.subscription_manager:
        class: 'Hgabka\EmailBundle\Helper\SubscriptionManager'
        arguments: ["@doctrine", "@hgabka_utils.hgabka_utils", '']

    hgabka_email.subscriber_subscriber:
        class: Hgabka\EmailBundle\EventListener\SubscriberSubscriber
        arguments: ['@hgabka_kunstmaan_email.subscription_manager']
        tags:
            - { name: doctrine.event_subscriber, connection: default }

    Hgabka\EmailBundle\Helper\MessageSender: "@hgabka_email.message_sender"
    Hgabka\EmailBundle\Helper\MailBuilder: "@hgabka_email.mail_builder"